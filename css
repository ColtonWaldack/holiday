import React, { useState } from 'react';

const RecipePage = () => {
  const [comments, setComments] = useState({});

  const addComment = (commentData) => {
    const timeStamp = new Date().getTime();
    setComments({ ...comments, [`comment-id${timeStamp}`]: commentData });
  };

  const editComment = (commentID, editedData) => {
    setComments({
      ...comments,
      [commentID]: {
        ...comments[commentID],
        commentBody: editedData,
      },
    });
  };

  const deleteComment = (commentID) => {
    const updatedComments = { ...comments };
    delete updatedComments[commentID];
    setComments(updatedComments);
  };

  const renderComment = (key) => {
    return (
      <li key={key}>
        <Comment
          index={key}
          details={comments[key]}
          editComment={editComment}
          deleteComment={deleteComment}
        />
      </li>
    );
  };

  return (
    <div>
      <ol className="comment-list">{Object.keys(comments).map(renderComment)}</ol>
      <AddCommentForm addComment={addComment} />
      <pre>{JSON.stringify(comments, null, 2)}</pre>
    </div>
  );
};
const AddCommentForm = ({ addComment }) => {
  const processComment = (event) => {
    event.preventDefault();

    const commentData = {
      commentName: event.target.name.value,
      commentBody: event.target.desc.value,
    };

    addComment(commentData);
    event.target.reset();
  };

  return (
    <div className="callout secondary">
      <h4 className="leave-comment">Add a Comment</h4>
      <form className="post-edit" onSubmit={processComment}>
        <input type="text" name="name" placeholder="Your Name" required />
        <textarea name="desc" placeholder="Add your comment here" required />
        <button
          id="submit"
          type="submit"
          className="button button-outline comment-button action-button expand-right"
        >
          Add Comment
        </button>
      </form>
    </div>
  );
};

const Comment = ({ index, details, editComment, deleteComment }) => {
  const [editMode, setEditMode] = useState(false);

  const renderCommentRead = () => {
    return (
      <div className="comment-text">
        <p>{details.commentBody}</p>
      </div>
    );
  };

  const editCommentHandler = (event) => {
    event.preventDefault();
    editComment(index, event.target.editText.value);
    setEditMode(false);
  };

  const deleteCommentHandler = () => {
    deleteComment(index);
  };

  const renderCommentEdit = () => {
    return (
      <form className="post-edit" onSubmit={editCommentHandler}>
        <textarea ref="editText" defaultValue={details.commentBody} required />
        <button
          type="submit"
          className="button button-outline comment-button action-button expand-right"
        >
          Save
        </button>
      </form>
    );
  };

  return (
    <div>
      {editMode ? renderCommentEdit() : renderCommentRead()}
      <button
        className="button button-outline comment-button action-button expand-right"
        onClick={() => setEditMode(!editMode)}
      >
        Edit
      </button>
      <button
        className="button alert comment-button action-button expand-right"
        onClick={deleteCommentHandler}
      >
        Delete
      </button>
    </div>
  );
};

export default RecipePage;
